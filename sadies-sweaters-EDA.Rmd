---
title: "Sadie's Sweaters, Part Two"
author: "Jenna Conklin"
date: "2024-03-18"
output: rmarkdown::github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
sweaters <- read.csv('cleaned_data.csv', header = T)
library(tidyverse)
library(ggridges)
library(rcartocolor)
library(cowplot)
my_colors <- carto_pal(12, "BluYl")
my_colors
my_colors2 <- c("#F7FEAE", "#B1E3A4", "#54B5A0", "#016280", "#045275")
my_colors3 <- c("#F7FEAE", "#54B5A0", "#045275")
my_colors4 <- c("#F7FEAE", "#B1E3A4", "#54B5A0","#13959A", "#016280", "#045275")
```

## Exploratory Data Analysis 

This is part two of the Sadie's Sweaters project, which presents an exploratory data analysis of 9108 sweater patterns retrieved from Ravelry,com, a global platform for the fiber arts community. To learn more about how the data was sourced and cleaned, see part one of the project. In this project segment, I explore the relationship between the number of times a Ravelry user added a project to their queue of future projects to complete (a proxy measure for interest in the pattern) and a number of other factors, including length of description, yarn weight, yardage of yarn required, average needle size, cost of pattern, number of languages pattern is available in, and more, and formulate some initial recommendations for our protaganist, Sadie, a pattern designer who is hoping to expand her offerings on Ravelry to include sweaters. 

## Length of Description

Is it important to have a pattern description of particular length to maximize interest in your patterns? The scatterplot below compares length of the notes field (in number of characters) and queued project count, a proxy for interest in a pattern. It seems evident that there is no strong relationship between the length of description and the amount of interest generated by a pattern. Very popular patterns had descriptions of many lengths, and no particular length appears to correspond to more or less interest. 

```{r description, echo = FALSE, message = FALSE}
ggplot(sweaters, aes(x=notes_length, y=queued_projects_count, color = notes_length)) + 
  geom_point() + 
  geom_smooth(color = "#016280") + 
  labs(x="Number of Characters in Pattern Description", y = "Number of Queued Projects", 
       title = "How does length of description impact interest in a pattern?") + 
  theme_classic() + 
    scale_color_gradientn(colors = my_colors2[2:5]) + 
  geom_hline(yintercept=0, linetype="solid", color ="gray20") + 
  theme(legend.position = "none")
```

## Properties of Yarn

An important aspect of planning a fiber arts project involves selecting and sourcing an appropriate yarn for the item to be created. Thus, it is easy to imagine that what type and amount of yarn a pattern is written for will be an important deciding factor for Ravelry users selecting a pattern. Below, I examined the distribution of yarn weights across patterns in the sample, taking into account whether the pattern was written for crochet or knitting. As can be seen, a sizable minority of patterns did not specify a yarn weight; of those that did specify a weight, an approximately normal distribution was present from the thinnest yarn weight (lace) to the thickest (super bulky / jumbo). The majority of patterns used DK, sport, aran, or worsted weight yarns, the mid range of weights available. 

```{r yarn weight, echo = FALSE, message = FALSE}
sweaters<- sweaters %>% 
  mutate(yarn_weight = replace_na(yarn_weight, "None Given"))%>%
  mutate(yarn_weight = ifelse(yarn_weight == "Any gauge", "Any Weight", yarn_weight))

sweaterssum <- sweaters %>%
  group_by(yarn_weight, craft_name) %>%
  summarize(count = n())%>%
  mutate(yarn_weight = factor(yarn_weight, levels = c("Any Weight", "None Given", "Lace", "Fingering", "DK / Sport", "Aran / Worsted", "(Super) Bulky / Jumbo")))

ggplot(sweaterssum, aes(x=yarn_weight, y=count, fill = craft_name)) + 
  geom_col() + 
  theme_classic() +
  theme(axis.text.x=element_text(angle = 45, vjust = 0.6))+
  labs(x="Yarn Weight from Thinnest to Thickest", y="Number of Patterns", fill = NULL)  +
  scale_fill_manual(values = my_colors)
```

While we now know the most common yarns present in the sample, how did the yarn weight given affect interest in the pattern? As we can see below, no notable trend emerges for yarn weight, except perhaps that patterns designed for any yarn weight sometimes generate slightly more interest than any specific weight, as evaluated through their queued project count. (For ease of visualization, upper outliers with regard to queued projects are omitted from graphics throughout this analysis.)

```{r yarn weight queued, echo = FALSE, message = FALSE, warning = FALSE}
sweaters %>%
  mutate(yarn_weight = factor(yarn_weight, levels = c("Any Weight", 
                                                      "None Given", "Lace", 
                                                      "Fingering", "DK / Sport", 
                                                      "Aran / Worsted", "(Super) Bulky / Jumbo")))%>%
  ggplot(aes(x=queued_projects_count, y = yarn_weight, fill = yarn_weight)) + 
  geom_density_ridges(scale = 3) + 
  scale_fill_manual(values = my_colors) +
  xlim(-50, 1000) + 
  labs(title = 'Queued Projects by Yarn Weight', y=NULL, x="Queued Projects (Trimmed)") + 
  theme_ridges() +
  theme(legend.position = "none", axis.title.x = element_text(hjust = 0.4), 
        axis.title.y = element_text(hjust = 0.5), plot.title = element_text(hjust = 0.4))
```

In addition to the type of yarn required, perhaps the amount of yarn needed for a project influences how interested users are in a pattern. Before investigating this directly, I checked whether there was an obvious relationship between the type and amount of yarn needed. 

```{r weight and yardage, echo = FALSE, message = FALSE, warning = FALSE}
sweaters %>%
  filter(yardage!="")%>%
  mutate(yardage = as.numeric(yardage)) %>%
  mutate(yarn_weight = factor(yarn_weight, levels = c("Any Weight", 
                                                      "None Given", "Lace", 
                                                      "Fingering", "DK / Sport", 
                                                      "Aran / Worsted", "(Super) Bulky / Jumbo")))%>%
  ggplot(aes(x=yardage, y = yarn_weight, fill = yarn_weight)) + 
  geom_density_ridges(scale = 3) + 
  scale_fill_manual(values = my_colors) +
  xlim(0, 10000) + 
  labs(title = 'Yarn Weight by Yardage', y="Yarn Weight", x="Yardage (Trimmed)") + 
  theme_ridges() +
  theme(legend.position = "none", axis.title.x = element_text(hjust = 0.4), 
        axis.title.y = element_text(hjust = 0.5), plot.title = element_text(hjust = 0.4))
```

Yardage appears to decrease slightly as yarn weight increases, which is sensible as less yardage of a thicker yarn is needed to make a fabric of similar size. But is there a relationship between the amount of interest generated by a pattern and the amount of yarn needed for it? Upon visual inspection of the scatterplot below, yardage does not appear to be a good predictor of interest in a pattern. 

```{r yardage queued, echo=FALSE}
sweaters %>%
  filter(yardage!="")%>%
  mutate(yardage = as.numeric(yardage)) %>%
  ggplot(aes(x=queued_projects_count, y = yardage, color = queued_projects_count)) + 
  geom_point() + 
  theme_classic() + 
  scale_color_gradientn(colors = my_colors2[2:5]) +
  labs(x = "Queued Projects", y = "Yardage", 
       color = "Queued Projects", 
       title = "Yardage Required for Project by Queued Project Count")+
  theme(legend.position = "none")
```

As a final inquiry related to yarn type, perhaps the number of specific yarns recommended for use in the pattern has an impact on interest. In the boxplots below, we see that the data is heavily right-skewed, making it difficult to assess differences between groups. In the second panel, I have eliminated outliers above 500 queued projects to allow for a closer visual inspection; however, even with this adjustment, the distributions appear to be fairly similar. If there is a relationship here, it is not visible to the naked eye. 

``` {r number of yarns, echo = FALSE, message = FALSE, warning = FALSE}
p1 <- sweaters %>%
  mutate(yarn_list_type = ifelse(is.na(yarn_list_type) == T, "0", factor(yarn_list_type))) %>%
  ggplot(aes(y = queued_projects_count, x = as.factor(yarn_list_type), fill = as.factor(yarn_list_type))) +
  geom_boxplot() + 
  scale_fill_manual(labels = c("None", "One", "Two"), values = my_colors3) +
  labs(y = "Queued Projects Count", x = "Number of Recommended Yarns", 
       title = "All Data", 
       fill = "Number of \nRecommended \nYarns")+
  theme_classic()

p2 <- sweaters %>%
  mutate(yarn_list_type = ifelse(is.na(yarn_list_type) == T, "0", factor(yarn_list_type))) %>%
  ggplot(aes(y = queued_projects_count, x = as.factor(yarn_list_type), fill = as.factor(yarn_list_type))) +
  geom_boxplot() + 
  ylim(0, 500) + 
  scale_fill_manual(labels = c("None", "One", "Two"), values = my_colors3) +
  labs(y = NULL, x = "Number of Recommended Yarns", 
       title = "Fewer than 500 Queued Projects", 
       fill = "Number of \nRecommended \nYarns") + 
  theme_classic()

p3 <- plot_grid(p1 + theme(legend.position="none"), p2 + theme(legend.position="none"))
legend <- get_legend(p2)
p <-plot_grid(p3, legend, rel_widths = c(1.7, .3))

title <- ggdraw() + draw_label("Queued Projects by Number of Recommended Yarns", fontface='bold')
plot_grid(title, p, ncol=1, rel_heights=c(0.1, 1)) # rel_heights values control title margins

```

## Needle Size

Closely related to yarn weight is the needle size used to create a project. Generally speaking, smaller needles are used for thinner yarns and vice versa, although the correspondence is not exact and different yarn and needle sizes may be mixed to create a range of effects. In this section, I will only examine knitting patterns, as knitting needle sizes are given in a different scale than crochet hook sizes and the vast majority of patterns in the sample are knitting patterns. 

To begin, I wanted to better understand the distribution of needle sizes in the sample. The correlation between needle size and yarn weight is illustrated in the heatmap below, which visualizes the number of patterns that use each yarn weight and needle size. As can be seen, most patterns use needle sizes 3 - 6 with DK, sport, aran, or worsted yarns, and the thicker aran and worsted yarns tend to appear with the slightly larger (size 5 - 6) needles, while the slightly finer DK and sport yarns tend to appear with a smaller recommended needle size of 3 to 4. However, some variation is present, especially in the super bulky/jumbo yarn weight column. 

```{r needle heatmap, echo = FALSE, message = FALSE}
sweaterssum2 <- sweaters %>%
  filter(average_needle_size != "None Given") %>%
  mutate(avg_need_siz_fac = case_when(average_needle_size <= 2 ~ "1 - 2", 
                                      average_needle_size >2 & average_needle_size <=4 ~ "3 - 4", 
                                      average_needle_size >4 & average_needle_size <=6 ~ "5 - 6", 
                                      average_needle_size >6 & average_needle_size <=8 ~ "7 - 8", 
                                      average_needle_size > 8 ~ ">8"),
         yarn_weight = factor(yarn_weight, levels = c("Any Weight", 
                                                      "None Given", "Lace", 
                                                      "Fingering", "DK / Sport", 
                                                      "Aran / Worsted", "(Super) Bulky / Jumbo")))%>%
  mutate(avg_need_siz_fac = factor(avg_need_siz_fac, levels = c("1 - 2", "3 - 4", "5 - 6", "7 - 8",">8"))) %>%
  group_by(yarn_weight, avg_need_siz_fac) %>%
  summarize(count = n())


sweaterssum2 %>%
  ggplot(aes(x=yarn_weight, y = avg_need_siz_fac, fill = count)) + 
  geom_tile() + 
  labs(x="Yarn Weight", y = "Average Needle Size", 
       title = "Heatmap of Yarn Weight by Average Needle Size \n(Knitting Patterns Only)", 
       fill = "Number of Patterns") + 
  scale_fill_gradient2(low = my_colors3[1], mid = my_colors3[2], high = my_colors3[3], midpoint = 800) +
  theme_classic() + 
  theme(axis.text.x=element_text(angle = 45, vjust = 0.6))
```

The distribution of needle sizes throughout the sample is roughly normal, with the majority of patterns recommending a needle in the size 3 - 6 range. Furthermore, most patterns are written for one or two recommended needle sizes, though a minority recommend three or more needle sizes. 

```{r needle size 1, echo = FALSE}
sweaters %>%
  filter(average_needle_size != "None Given") %>%
  mutate(avg_need_siz_fac = case_when(average_needle_size <= 2 ~ "1 - 2", 
                                      average_needle_size >2 & average_needle_size <=4 ~ "3 - 4", 
                                      average_needle_size >4 & average_needle_size <=6 ~ "5 - 6", 
                                      average_needle_size >6 & average_needle_size <=8 ~ "7 - 8", 
                                      average_needle_size > 8 ~ ">8") 
         )%>%
  mutate(avg_need_siz_fac = factor(avg_need_siz_fac, levels = c("1 - 2", "3 - 4", "5 - 6", "7 - 8",">8"))) %>%
  ggplot(aes(x = avg_need_siz_fac, fill = factor(needle_size_count))) + 
  geom_bar(position = "stack") +
  labs(x = "Average Needle Size", y = "Number of Patterns", fill = "Number of Needle \nSizes Given", 
       title = "Average Needle Size and Number of Needle Sizes Given\n(Knitting Patterns Only)") + 
  scale_fill_manual(values = my_colors)+ 
  scale_y_continuous(labels = scales::comma) + 
  theme_classic()
```

Now that we know how needle size is distributed through the sample, it is time to examine whether it is relates to interest in a pattern in any way. To do this, let us consider how average needle size and number of recommended needle sizes relate to how often users add a pattern to their project queue. (Each of these graphs is trimmed to remove outliers not visible in the ridge plot.) 

```{r needle size 2, echo = FALSE, message = FALSE, warning = FALSE}
p7 <- sweaters %>%
  filter(average_needle_size != "None Given") %>%
  mutate(avg_need_siz_fac = case_when(average_needle_size <= 2 ~ "1 - 2", 
                                      average_needle_size >2 & average_needle_size <=4 ~ "3 - 4", 
                                      average_needle_size >4 & average_needle_size <=6 ~ "5 - 6", 
                                      average_needle_size >6 & average_needle_size <=8 ~ "7 - 8", 
                                      average_needle_size > 8 ~ ">8"))%>%
  mutate(avg_need_siz_fac = factor(avg_need_siz_fac, levels = c("1 - 2", "3 - 4", "5 - 6", "7 - 8",">8"))) %>%
  
  ggplot(aes(x=queued_projects_count, y = avg_need_siz_fac, fill = avg_need_siz_fac)) + 
  geom_density_ridges(scale = 3) + 
  scale_fill_manual(values = my_colors2) +
  xlim(-50, 1000) + 
  labs(title = NULL, y="Average Needle Size", x="Queued Projects (Trimmed)") + 
  theme_ridges() +
  theme(legend.position = "none", axis.title.x = element_text(hjust = 0.4), 
        axis.title.y = element_text(hjust = 0.5), plot.title = element_text(hjust = 0.4))

p6 <- sweaters %>%
  ggplot(aes(x=queued_projects_count, y = as.factor(needle_size_count), fill = as.factor(needle_size_count))) + 
  geom_density_ridges(scale = 3) + 
  scale_fill_manual(values = my_colors4) +
  xlim(-50, 1500) + 
  labs(title = NULL, y="Number of Needle Sizes Given", x="Queued Projects (Trimmed)") + 
  theme_ridges() +
  theme(legend.position = "none", axis.title.x = element_text(hjust = 0.4), 
        axis.title.y = element_text(hjust = 0.5), plot.title = element_text(hjust = 0.4))

p15 <- plot_grid(p6, p7)


title2 <- ggdraw() + draw_label("Average Needle Size and Number of Needle Sizes \nGiven for Project by Queued Project Count\n(Knitting Patterns Only)", fontface='bold')
plot_grid(title2, p15, ncol=1, rel_heights=c(0.2, 1)) # rel_heights values control title margins

```

As we can see, interest in a pattern is generally similar across needle sizes and numbers of recommended needle sizes, but some patterns with larger needles manage to generate greater than average interest (the bumps on the average needle size > 8 row), as do a few of the patterns that give four and five needle sizes to choose from. 

## Round and Flat Patterns

Another key difference in knitting patterns comes in the design of the pattern itself. Sweaters require a number of elements that are roughly cylindrical (think of the sleeves and trunk of a sweater), and thus have the option to be worked "in the round", meaning the the knitting proceeds in a spiral fashion rather than a flat, back-and-forth style. Items worked flat will require seams to create a cylindrical shape, while items worked in the round require a special type of needle, known as circular needles. Beginners typically learn to knit flat first, and then learn to knit in the round as their skills increase, although there is an argument to be made for knitting in the round being simpler overall. All this being said, will patterns written in the round versus those meant to be worked flat generate notably different interest among Ravelry users? 

```{r round and flat, echo = FALSE, warning = FALSE}
p10<- sweaters %>%
  filter(craft_name == "Knitting") %>%
  ggplot(aes(y=queued_projects_count, x=workstyle, fill = workstyle)) + 
  geom_violin() + 
  labs(y = "Queued Projects", x = NULL, title = "All Data") + 
  scale_fill_manual(values = my_colors2)+
  theme_classic() + 
  theme(legend.position = "none")

p11 <- sweaters %>%
  filter(craft_name == "Knitting") %>%
  ggplot(aes(y=queued_projects_count, x=workstyle, fill = workstyle)) + 
  geom_violin() + 
  ylim(0, 500) +
  labs(y = NULL, x = NULL, title = "Fewer than 500 Queued Projects") + 
  scale_fill_manual(values = my_colors2)+
  theme_classic() + 
  theme(legend.position = "none")

p16 <- plot_grid(p10, p11)
title3 <- ggdraw() + draw_label("Round vs. Flat by Queued Project Count", fontface='bold')
plot_grid(title3, p16, ncol=1, rel_heights=c(0.1, 1)) # rel_heights values control title margins

```

As for previous inquiries, the right-skewed nature of the data makes it difficult to spot differences in the left panel. The right panel, which excludes outliers above 500, is clearer. Patterns worked in the round may generate slightly more interest than those worked flat, but a great many patterns in the sample fall outside these two categories, being tagged either with both or neither. Patterns tagged with both "in the round" and "worked flat" may be patterns that include multiple elements, such as a matching hat and scarf, or those for which a part of the pattern is worked flat and a part is worked in the round, such as the sleeves and body of a sweater. Those tagged "neither" must in fact be worked in one fashion or the other, but the pattern designer did not utilize the pattern attribute tags for flat or round work when uploading their pattern. 

Based on this exploration, I will recommend that Sadie consider designing patterns worked in the round over those worked flat, pending the outcome of the inferential analysis later on in this project. 

## Petite and Plus-Sized Patterns

Does offering plus or petite sizing increase interest in a pattern? Once again, it is difficult to draw any insights from the full dataset (left panel), but a closer look (right panel) suggests that patterns offering either or both extra sizing options likely generate slightly more interest than those with neither, although the difference is small. 

```{r plus petite, echo = FALSE, warning = FALSE} 
p12<- sweaters %>%
  ggplot(aes(y=queued_projects_count, x=plus_petite, fill = plus_petite)) + 
  geom_violin() + 
  labs(y = "Queued Projects Count", x = NULL, title = "All Data") + 
  scale_fill_manual(values = my_colors2)+
  theme_classic() + 
  theme(legend.position = "none")

p13 <- sweaters %>%
  ggplot(aes(y=queued_projects_count, x=plus_petite, fill = plus_petite)) + 
  geom_violin() + 
  ylim(0, 500) +
  labs(y = NULL, x = NULL, title = "Fewer than 500 Queued Projects") + 
  scale_fill_manual(values = my_colors2)+
  theme_classic() + 
  theme(legend.position = "none")

p17<-plot_grid(p12, p13)
title4 <- ggdraw() + draw_label("Plus and Petite Sizes Offered by Queued Project Count", fontface='bold')
plot_grid(title4, p17, ncol=1, rel_heights=c(0.1, 1)) # rel_heights values control title margins

```

### Free versus Paid Patterns

How does offering a pattern for free affect interest in a pattern? As can be seen, a few upper outliers suggest that paid patterns generate more interest, while the position of means and third quartiles suggest that free patterns generate more interest. Both differences are so slight, however, that I would recommend Sadie consider the economic necessities of her Ravelry store in deciding whether to offer patterns for free rather than just considering the data from this sample. 

```{r free, echo = FALSE, warning = FALSE} 
p8<- ggplot(sweaters, aes(y=queued_projects_count, x=free, fill = free)) + 
  geom_boxplot() + 
  labs(y = "Queued Projects Count", x = NULL, title = "All Data") + 
  scale_x_discrete(labels = c("Not Free", "Free"))+
  theme_classic() + 
  theme(legend.position = "none")

p9 <- ggplot(sweaters, aes(y=queued_projects_count, x=free, fill = free)) + 
  geom_boxplot() + 
  ylim(0, 500) +
  labs(y = NULL, x = NULL, title = "Fewer than 500 Queued Projects") + 
  scale_x_discrete(labels = c("Not Free", "Free"))+
  scale_fill_manual(values = my_colors3)+
  theme_classic() + 
  theme(legend.position = "none")

p18<-plot_grid(p8, p9)
title5 <- ggdraw() + draw_label("Queued Projects by Pattern Cost", fontface='bold')
plot_grid(title5, p18, ncol=1, rel_heights=c(0.1, 1)) # rel_heights values control title margins

```

## Languages

Does the number of languages a pattern is available in affect interest in a pattern? An initial inspection of the data suggests that it does not, given the low queued project counts observed among patterns offered in many languages and the lack of an obvious trend in the data. Perhaps the inferential analysis in part three of the project will offer greater insight on this point. 

```{r languages, echo = FALSE}
ggplot(sweaters, aes(x = queued_projects_count, y = language_count, color = queued_projects_count)) + 
  geom_point() +
  labs(x = "Queued Projects", y = "Number of Languages Pattern Is Available In", 
       title = "Queued Projects by Number of Languages") + 
  scale_color_gradientn(colors = my_colors2[2:5]) + 
  theme_classic() +
  theme(legend.position = "none")

```

## Conclusion

Based on my findings in this exploratory analysis, my initial recommendation is that Sadie consider designing knit patterns in the round, offering patterns for free to generate more traffic to her shop, offering extra sizing (such as plus or petite size options), and including instructions for a range of needle sizes, ideally 4 - 5 sizes. I would not recommend that she select yarn weight, needle size, language options, or yardage of yarn required based on their potential to generate more interest in the pattern on Ravelry, as none of these factors appear to correlate to increased interest in the sample analyzed here. Furthermore, Sadie should not elevate any of the factors I have flagged as important above her own design considerations as an artist, as each of the relationships I have described appears to be either fairly weak or predict only a slight increase in interest. In the next segment of the project, I will investigate these factors further in an inferential analysis to better understand relationships that are not readily apparent upon simple visual inspection of the data. 